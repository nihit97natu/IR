<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="Dashboard">
  <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
  <title>TweetPeek</title>

  <!-- Favicons -->
  <link href="../static/img/favicon.png" rel="icon">
  <link href="../static/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Bootstrap core CSS -->
  <link href="../static/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <!--external css-->
  <link href="../static/lib/font-awesome/css/font-awesome.css" rel="stylesheet" />
  <link rel="stylesheet" type="text/css" href="../static/css/zabuto_calendar.css">
  <link rel="stylesheet" type="text/css" href="../static/lib/gritter/css/jquery.gritter.css" />
  <!-- Custom styles for this template -->
  <link href="../static/css/style.css" rel="stylesheet">
  <link href="../static/css/style-responsive.css" rel="stylesheet">
  <script src="../static/lib/chart-master/Chart.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <!-- =======================================================
    Template Name: Dashio
    Template URL: https://templatemag.com/dashio-bootstrap-admin-template/
    Author: TemplateMag.com
    License: https://templatemag.com/license/
  ======================================================= -->
</head>

<body>
  <section id="container">
    <!-- **********************************************************************************************************************************************************
        TOP BAR CONTENT & NOTIFICATIONS
        *********************************************************************************************************************************************************** -->
    <!--header start-->
    <header class="header black-bg">
      <div class="sidebar-toggle-box">
        <div class="fa fa-bars tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
      </div>
      <!--logo start-->
      <a href="index.html" class="logo"><b>Tweet<span>PEEK</span></b></a>
      <!--logo end-->
      <div class="nav notify-row" id="top_menu">
        <!--  notification start -->
                <!--  notification end -->
      </div>
      
    </header>
    <!--header end-->
    <!-- **********************************************************************************************************************************************************
        MAIN SIDEBAR MENU
        *********************************************************************************************************************************************************** -->
    <!--sidebar start-->
    <aside>
      <div id="sidebar" class="nav-collapse ">
        <!-- sidebar menu start-->
        <ul class="sidebar-menu" id="nav-accordion">
          <li class="mt">
            <a class="active" href="/">
              <i class="fa fa-dashboard"></i>
              <span>Dashboard</span>
              </a>
          </li>
          <!-- <li class="sub-menu">
            <a href="javascript:;">
              <i class="fa fa-desktop"></i>
              <span>UI Elements</span>
              </a>
            <ul class="sub">
              <li><a href="general.html">General</a></li>
              <li><a href="buttons.html">Buttons</a></li>
              <li><a href="panels.html">Panels</a></li>
              <li><a href="font_awesome.html">Font Awesome</a></li>
            </ul>
          </li> -->
         <li>
         </br>
         <h3>Facet Search By:</h3>
         <hr>
         <form class="">
             <h4>Country</h4>
             <input class="form-check-input facetsearch" type="checkbox" value="india" id="country">
             <label class="form-check-label"  style="color: white">
                 India
             </label></br>
           
           <input class="form-check-input facetsearch" type="checkbox" value="usa" id="country">
             <label class="form-check-label" style="color: white">
                 USA
             </label></br>
           
           <input class="form-check-input facetsearch" type="checkbox" value="brazil" id="country">
             <label class="form-check-label" style="color: white">
                 Brazil
             </label></br>
             <h4>User Verification</h4>
             <input class="form-check-input facetsearch" type="checkbox" value="True" id="verification">
             <label class="form-check-label" style="color: white">
                 Verified
             </label></br>
             
             <input class="form-check-input facetsearch" type="checkbox" value="False" id="verification">
             <label class="form-check-label" style="color: white">
                 Not Verified
             </label></br>
             
             <h4>Language</h4>
             <input class="form-check-input facetsearch" type="checkbox" value="hi" id="language">
             <label class="form-check-label" style="color: white">
                 Hindi
             </label></br>
             
             <input class="form-check-input facetsearch" type="checkbox" value="en" id="language">
             <label class="form-check-label" style="color: white">
                 English
             </label></br>
             
             <input class="form-check-input facetsearch" type="checkbox" value="pt" id="language">
             <label class="form-check-label" style="color: white">
                 Portuguese
             </label>
         </form>
         </li>


          
        </ul>
        <!-- sidebar menu end-->
      </div>
    </aside>
    <!--sidebar end-->
    <!-- **********************************************************************************************************************************************************
        MAIN CONTENT
        *********************************************************************************************************************************************************** -->
    <!--main content start-->
    <section id="main-content">
      <section class="wrapper">
        <div class="row">
          <div class="col-lg-12 main-chart">
            <!--CUSTOM CHART START -->
            <div class="border-head">
              <h3>ANALYSIS</h3>
            </div>
            
            <div class="row mt" style="margin-top: 0px">
              <!-- SERVER STATUS PANELS -->
              <div class="col-md-4 col-sm-4 mb">
                <div class="grey-panel pn donut-chart">
                  
                  <div class='tableauPlaceholder' id='viz1575302858346' style='position: relative'><noscript><a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Co&#47;CountryTopTrends&#47;Sheet1&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='CountryTopTrends&#47;Sheet1' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;Co&#47;CountryTopTrends&#47;Sheet1&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /></object>
                  </div>
                  <script type='text/javascript'>
                      var divElement = document.getElementById('viz1575302858346');
                      var vizElement = divElement.getElementsByTagName('object')[0];                    vizElement.style.width='380px';vizElement.style.height='250px';
                      var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);
                      </script>
                </div>
                <!-- /grey-panel -->
              </div>
              <!-- /col-md-4-->
              
              <div class="col-md-4 col-sm-4 mb">
                <div class="darkblue-panel pn">
                  
                  <div class='tableauPlaceholder' id='viz1575246204461' style='position: relative'><noscript><a href='#'><img alt=' ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;In&#47;Indiatrends&#47;Dashboard1&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz'  style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='embed_code_version' value='3' /> <param name='site_root' value='' /><param name='name' value='Indiatrends&#47;Dashboard1' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;In&#47;Indiatrends&#47;Dashboard1&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='filter' value='publish=yes' /></object>
                  </div>
                  
                  
                  <script type='text/javascript'>
                      
                          var divElement = document.getElementById('viz1575246204461');
                          var vizElement = divElement.getElementsByTagName('object')[0];                    if ( divElement.offsetWidth > 800 ) { vizElement.style.width='380px';vizElement.style.height='250px';} else if ( divElement.offsetWidth > 500 ) { vizElement.style.width='380px';vizElement.style.height='250px';} else { vizElement.style.width='380px';vizElement.style.height='250px';}
                          var scriptElement = document.createElement('script');                    scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';                    vizElement.parentNode.insertBefore(scriptElement, vizElement);
                      
                      </script>

                </div>
                <!--  /darkblue panel -->
              </div>
              <!-- /col-md-4 -->
              <div class="col-md-4 col-sm-4 mb">
                <!-- REVENUE PANEL -->
                
                  <div id="chart_div" style="position: relative; width: 380px; height: 250px; display: block; padding-left: 0px"></div>
                </div>
                
                <script type="text/javascript">
                    var sentiment_values = new Array();
                    var yyyy = new Array();
                    var mm = new Array();
                    var dd = new Array();
                    var i = 0;
                    var z = 0;
                    
                    {% for res in data %}
                    if("{{res.sentiment.0}}" == "POSITIVE"){
                        sentiment_values[i] = 1;
                        i++;
                    }
                    else if("{{res.sentiment.0}}" == "NEGATIVE"){
                        sentiment_values[i] = -1;
                        i++;
                    }
                    else{
                        sentiment_values[i] = 0;
                        i++;
                    }
                    
                    
                    var tweet_date = "{{res.tweet_date.0}}";
                    var ytemp = tweet_date.split('-');
                    yyyy[z] = ytemp[0];
                    var mtemp = ytemp[1].split(',');
                    mm[z] = mtemp;
                    var dtemp = ytemp[2].split('T');
                    dd[z] = dtemp[0];
                    
                    z++;
                    
                    {% endfor %}
                    
                    
                    
                    var sentiment_graph = new Array();
                    sentiment_graph[0] = ['Tweet Date', 'Sentiment Value'];
                    
                    var j;
                    for(j = 0; j < sentiment_values.length; j++) {
                        sentiment_graph[j + 1] = [new Date(yyyy[j], mm[j], dd[j]), parseInt(sentiment_values[j])];
                    }
                    google.charts.load('current', {'packages':['annotationchart']});
                    google.charts.setOnLoadCallback(drawChart);

                    function drawChart() {
                    var data = google.visualization.arrayToDataTable(sentiment_graph, false);

                    
                    var options = {
                    displayAnnotations: true
                    };

                    var chart = new google.visualization.AnnotationChart(document.getElementById('chart_div'));

                    chart.draw(data, options);
                    }
                    
                    
                </script>
              </div>
              <!-- /col-md-4 -->
            </div>
            <!-- /row -->
            
           <div>
               
          <!-- /col-lg-9 END SECTION MIDDLE -->
          
          
          <!-- Second row for analysis -->
              <div class="col-md-4 col-sm-4 mb">
                <!-- REVENUE PANEL -->
                
                  <div id="piechart" style="position: relative; width: 380px; height: 250px; display: block; padding-left: 0px"></div>
                </div>
                
                <script type="text/javascript">
                    
                    var country_india = 0;
                    var country_usa = 0;
                    var country_brazil = 0;
                    var country_name = new Array();
                    var i = 0;
                    var z = 0;

                    {% for res in data %}
                    
                    country_name[z] = "{{res.country.0}}";
                    z++;
                    
                    {% endfor %}
                    
                    for(var x = 0; x < sentiment_values.length; x++) {
                        if(country_name[x] == "India") {
                            country_india = country_india + 1;
                        }
                        if(country_name[x] == "USA") {
                            country_usa = country_usa + 1;
                        }
                        if(country_name[x] == "Brazil") {
                            country_brazil = country_brazil + 1;
                        }
                    }
                    
                   
                   google.charts.load('current', {'packages':['corechart']});
                   google.charts.setOnLoadCallback(drawPieChart);


                    function drawPieChart() {
                    var data = google.visualization.arrayToDataTable([
                                            ['Place', 'Tweets Count'],
                                            ['India', country_india],
                                            ['USA', country_usa],
                                            ['Brazil', country_brazil]
                    ]);

                    var options = {
                      title: 'No. Of Tweets Per Country'
                    };

                    var chart = new google.visualization.PieChart(document.getElementById('piechart'));

                    chart.draw(data, options);
                    }
                    
                    
                </script>
              </div>
              <!-- /col-md-4 -->
              
              <!-- Second row for analysis -->
                  <div class="col-md-4 col-sm-4 mb">
                    <!-- REVENUE PANEL -->
                    
                      <div id="piechart_lang" style="position: relative; width: 380px; height: 250px; display: block; padding-left: 0px"></div>
                    </div>
                    
                    <script type="text/javascript">
                        
                        var lang_hi = 0;
                        var lang_pt = 0;
                        var lang_en = 0;
                        var lang_name = new Array();
                        var i = 0;
                        var z = 0;

                        {% for res in data %}
                        
                        lang_name[z] = "{{res.tweet_lang.0}}";
                        z++;
                        
                        {% endfor %}
                        
                        for(var x = 0; x < sentiment_values.length; x++) {
                            if(lang_name[x] == "hi") {
                                lang_hi = lang_hi + 1;
                            }
                            if(lang_name[x] == "en") {
                                lang_en = lang_en + 1;
                            }
                            if(lang_name[x] == "pt") {
                                lang_pt = lang_pt + 1;
                            }
                        }
                        
                       
                       google.charts.load('current', {'packages':['corechart']});
                       google.charts.setOnLoadCallback(drawPieChart);


                        function drawPieChart() {
                        var data = google.visualization.arrayToDataTable([
                                                ['Language', 'Tweets Count'],
                                                ['Hindi', lang_hi],
                                                ['English', lang_en],
                                                ['Portuguese', lang_pt]
                        ]);

                        var options = {
                          title: 'No. Of Tweets Per Language'
                        };

                        var chart = new google.visualization.PieChart(document.getElementById('piechart_lang'));

                        chart.draw(data, options);
                        }
                        
                        
                    </script>
                  </div>
              
            </div>
            <!-- /row -->
            
           <div>
               
          <!-- /col-lg-9 END SECTION MIDDLE -->


          <form action="search_str" method="POST">
              {% csrf_token %}
            <div class="form-group">
                <div class="col-xs-3" style="width:100%">
                    <input class="form-control" id="inputdefault" type="text" name="search" placeholder="Enter Query Keyword" />
                    <br>
                    <p>Search, you searched for: {{ query }}</p>
                    <p id="works"></p>

                    <!-- post btn -->
                    <input type="submit" name="action" value="Search" class="btn btn-primary" />
                    <br>
                    
                </div>
            </div>

            <br>
        </form>

        <div class="row" style="margin-right:0px; margin-left:0px">
            <div class="col-md-12" style="margin-top:10px">
              <div class="content-panel">
                <!-- <h4><i class="fa fa-angle-right"></i> Basic Table</h4> -->
                
                <div id='results'>
                <table class="table">
                  <thead>
                    <tr>
                      <th>POI name</th>
                      <th>Tweet Date</th>
                      <th>Tweet</th>
                      <th>News Article</th>
                      
                    </tr>
                  </thead>
                  <tbody>
                      {% for res in data %}
                    <tr>
                      <td>{{res.poi_name.0}}</td>
                      <td>{{res.created_at.0}}</td>
                      <td>{% if not res.full_text %}
                          {{res.text.0}}
                           {% endif %}
     
                          {% if res.full_text %}
                          {{res.full_text.0}}
                          {% endif %}
                      </td>
                      <td>{% if not res.newsarticle %}
                          {No articles found}
                           {% endif %}
     
                          {% if res.newsarticle %}
                          <a href="{{res.newsarticle.0}}" />
                          {{res.newsarticle.0}}
                          {% endif %}}</td>
                      
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              </div>
            </div>
          </div>

        
          <!-- /col-md-4 -->
        </div>

            </div>
          </div>
        <!-- /row -->
      </section>
    </section>
    <!--main content end-->
    <!--footer start-->
    
    <!--footer end-->
  </section>
  <!-- js placed at the end of the document so the pages load faster -->
  <script src="../static/lib/jquery/jquery.min.js"></script>

  <script src="../static/lib/bootstrap/js/bootstrap.min.js"></script>
  <script class="include" type="text/javascript" src="../static/lib/jquery.dcjqaccordion.2.7.js"></script>
  <script src="../static/lib/jquery.scrollTo.min.js"></script>
  <script src="../static/lib/jquery.nicescroll.js" type="text/javascript"></script>
  <script src="../static/lib/jquery.sparkline.js"></script>
  <!--common script for all pages-->
  <script src="../static/lib/common-scripts.js"></script>
  <script type="text/javascript" src="../static/lib/gritter/js/jquery.gritter.js"></script>
  <script type="text/javascript" src="../static/lib/gritter-conf.js"></script>
  <!--script for this page-->
  <script src="../static/lib/sparkline-chart.js"></script>
  <script src="../static/lib/zabuto_calendar.js"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      var unique_id = $.gritter.add({
        // (string | mandatory) the heading of the notification
        
      });

      return false;
    });
    

  </script>
  <script type="application/javascript">
    $(document).ready(function() {
      $("#date-popover").popover({
        html: true,
        trigger: "manual"
      });
      $("#date-popover").hide();
      $("#date-popover").click(function(e) {
        $(this).hide();
      });

      $("#my-calendar").zabuto_calendar({
        action: function() {
          return myDateFunction(this.id, false);
        },
        action_nav: function() {
          return myNavFunction(this.id);
        },
        ajax: {
          url: "show_data.php?action=1",
          modal: true
        },
        legend: [{
            type: "text",
            label: "Special event",
            badge: "00"
          },
          {
            type: "block",
            label: "Regular event",
          }
        ]
      });
    });

    function myNavFunction(id) {
      $("#date-popover").hide();
      var nav = $("#" + id).data("navigation");
      var to = $("#" + id).data("to");
      console.log('nav ' + nav + ' to: ' + to.month + '/' + to.year);
    }
  </script>
 
<script>
    var token = '{{csrf_token}}';
    $('.facetsearch').on('click',function(e){
        var data = {};
        var query = "{{query}}";
        var country_filter = get_filters('country');
        var language_filter = get_filters('language');
        var verified_filter = get_filters('verification');
        
        data['q'] = query;
        data['cf'] = country_filter;
        data['lf'] = language_filter;
        data['vf'] = verified_filter;
        
        data = JSON.stringify(data);
        
      $.ajaxSetup({
        headers:{ "X-CSRFToken": token }
      });
      
      $.post('/facetsearch', data,   
        function(response){ 
                  //alert('yes');
                  //alert(response);
                  $("#results").html(response);
                  //alert('no');
                }
      );
    
    }); 
  
    function get_filters(filter_id){
        //alert('inside get filters');
        //alert(filter_id);
        var filterValues = [];
        $('#'+filter_id+':checked').each(function(){
        filterValues.push($(this).val());
        });
        //alert(filterValues);
        return filterValues;
    }
    </script>
    
    
    

</body>

</html>
